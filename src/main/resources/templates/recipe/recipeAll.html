<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">

<head>
	<meta charset="UTF-8">
	<title>レシピ一覧</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" th:href="@{/css/style.css}" />
</head>

<body>
	<div class="layout-container">
		<div class="left-align">
			<form th:action="@{/addRecipeForm}" method="get">
				<input type="submit" value="入力フォーム">
			</form>
		</div>
		<div class="right-align">
			<div sec:authorize="isAuthenticated()">
				<p>ユーザー認証済み: <span sec:authentication="name">ログイン情報</span></p>
			</div>
			<form th:action="@{/logout}" method="post">
				<input type="hidden" name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				<input type="submit" value="ログアウト">
			</form>
		</div>
	</div>

	<div class="layout-container">
		<div class="button-container">
			<form action="/moveMainMenu" method="get">
				<input type="submit" value="メインメニュー">
			</form>
		</div>
	</div>

	<h1>レシピ一覧</h1>
	<table border="1">
		<thead>
			<tr bgcolor="silver">
				<th>レシピ画像</th>
				<th>レシピ名称</th>
				<th>レシピ削除</th>
			</tr>
		</thead>
		<tbody>
			<tr th:if="${recipeList == null || #lists.isEmpty(recipeList)}">
				<td colspan="3">メニューがありません。</td>
			</tr>

			<tr th:each="recipe : ${recipeList}">
				<td>
					<!--                    <img th:if="${recipe != null && recipe.imagefile != null && recipe.imagefile.fileData != null}"-->
					<!--                         th:src="'data:image/jpeg;base64,' + ${T(java.util.Base64).getEncoder().encodeToString(recipe.imagefile.fileData)}"-->
					<!--                         alt="アップロードされた画像" class="auto-height-image2" />-->
					<!--                    <p th:if="${recipe == null || recipe.imagefile == null || recipe.imagefile.fileData == null}">-->
					<!--                         画像がアップロードされていません。-->
					<!--                    </p>-->
					<img th:if="${recipe.imagefile.fileDataView != null}"
						th:src="'data:image/jpeg;base64,' + ${recipe.imagefile.fileDataView}" alt="アップロードされた画像"
						class="auto-height-image" />
					<p th:if="${recipe.imagefile.fileDataView == null}">画像がアップロードされていません。</p>

				</td>
				<td>
					<form th:action="@{/recipe}" method="get">
						<input type="submit" th:value="${recipe.recipeName}" name="button" />
					</form>
				</td>
				<td>
					<form th:action="@{/deleteRecipe}" method="post">
						<input type="hidden" name="delete" th:value="${recipe.recipeName}" />
						<input type="hidden" name="${_csrf.parameterName}" th:value="${_csrf.token}" />
						<button type="submit" onclick="return confirm('本当に削除しますか？');">削除</button>
					</form>
				</td>
			</tr>
		</tbody>
	</table>
</body>

</html>